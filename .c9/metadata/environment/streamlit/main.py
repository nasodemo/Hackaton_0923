{"changed":true,"filter":false,"title":"main.py","tooltip":"/streamlit/main.py","value":"import streamlit as st\nimport pandas as pd\n\n\n\nimport openai\nimport streamlit as st\nfrom streamlit_chat import message\nfrom streamlit_autorefresh import st_autorefresh\nopenai.api_key = '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'\n\nlanguage = st.selectbox('Choose Language', [\n    'ENG',\n    'í•œêµ­ì–´'\n])\nst.write('You selected:', language)\nst.header(\"ğŸ¤–OttugiGPT-3 (Demo)\")\n\n#### ê¸°ë³¸ ë³€ìˆ˜ ê³µê°„ ì„ ì–¸ ####\nif 'language' not in st.session_state or st.session_state['language'] != language:\n    st.session_state['language'] = language\n\nif 'generated' not in st.session_state:\n    # st.session_state['generated'] = []\n    st.session_state['generated'] = 'start'\n \nif 'past' not in st.session_state:\n    st.session_state['past'] = []\n##################\n    \n\ndef generate_response(user_input, prompt): # gptë¡œ ë‹µë³€ ë§Œë“¤ê¸°\n    response = openai.ChatCompletion.create(\n    model=\"gpt-3.5-turbo\",\n    # model=\"gpt-4-0613\",\n    messages=[\n        {\"role\": \"system\", \"content\": prompt},\n        {\"role\": \"user\", \"content\": user_input},\n    ],\n    # max_token=200,\n    # stop=None,\n    # temperature=0,\n    # top_p=1,\n    )\n \n    message = response.choices[0].message.content\n    return message\n    \ndef Chat_message(generated, key): # ë‹µë³€ ì„¤ì •\n    message(generated, \n    key=key, \n    avatar_style=\"adventurer\", # ì•„ì´ì½˜ ë³€ê²½ì‹œ ì˜¤ë¥¸ìª½ ë¬¸ì„œë¥¼ ì°¸ê³ í•  ê²ƒ https://docs.streamlit.io/library/api-reference/chat/st.chat_message\n    seed=123,)\n    \ndef Display(user_input):\n    ## Manual part\n    if user_input == \"ë ˆì‹œí”¼ ì•Œë ¤ì¤˜\":\n        output = \"ê¹€íƒœìš±ì˜ ë‹µë³€ ã…ã…: ë¼ë©´ì— ì¹˜ì¦ˆë¥¼ ë„£ì–´ë³´ì„¸ìš”!\"\n    \n    ## GPT Part\n    else: \n        prompt = \"You are a counselor for Ottogi(ì˜¤ëšœê¸° in korean) food company. Talk shorter than normal.\"\\\n        f\"You should use {st.session_state['language']} for this customer\"\\\n        \"Below things are history of your chat\"\\\n        f\"{st.session_state['generated']}\"\\\n        f\"{st.session_state['past']}\"\n        output = generate_response(user_input, prompt)\n    st.session_state.past.append(user_input)\n    st.session_state.generated.append(output)\n    st_autorefresh(interval=5*10, key=\"dataframerefresh\")\n\n## Intro Part\n# st.text(f\"{st.session_state['generated']}\")\nif st.session_state['generated'] == []:\n    \n    if st.session_state['language'] == \"ENG\":\n        output = \"I'm master of food~ \\n Ask EVERYTHING for your dish!\"\n    elif st.session_state['language'] == \"í•œêµ­ì–´\":\n        output = \"ì•ˆë…•í•˜ì„¸ìš”! ë°±ì¢…ì›ê¸‰ ìŒì‹ ì±—ë´‡ ì˜¤ì¹´ì˜¤ë´‡ì…ë‹ˆë‹¤! \\n ì¦‰ì„ ì‹í’ˆì— ëŒ€í•´ ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”!\"\n    st.session_state.generated.append(output)\n\n## Display Part\nif st.session_state['generated']:\n    Chat_message(st.session_state[\"generated\"][0], 'start_use')\n    for i in range(len(st.session_state['generated'])-1):\n        message(st.session_state['past'][i], is_user=True, key=str(i) + '_user')\n        Chat_message(st.session_state[\"generated\"][i+1], str(i+1))\n\n\n# Expected Questions\n    \ncol1, col2 = st.columns(2, gap=\"small\")\nwith col1:\n    if st.button(\"Do you have any preference of food?\", type=\"secondary\"):\n        Display(\"ìŒì‹ ì„ í˜¸ ë¦¬ìŠ¤íŠ¸ ë³´ì—¬ì¤˜\")\n    \nwith col2:\n    if st.button(\"Do you have any dispreference of food?\", type=\"secondary\"):\n        Display(\"ìŒì‹ ë¶ˆí˜¸ ë¦¬ìŠ¤íŠ¸ ë³´ì—¬ì¤˜\")\n\n## ë‹µë³€ ì „ì†¡ë€\nwith st.form('form', clear_on_submit=True):\n    \n    if st.session_state['language'] == \"ENG\":\n        Intro = \"I'm master of food~ \\n Ask EVERYTHING for your dish!\"\n    elif st.session_state['language'] == \"í•œêµ­ì–´\":\n        Intro = \"ì•ˆë…•í•˜ì„¸ìš”! ë°±ì¢…ì›ê¸‰ ìŒì‹ ì±—ë´‡ ì˜¤ì¹´ì˜¤ë´‡ì…ë‹ˆë‹¤! \\n ì¦‰ì„ ì‹í’ˆì— ëŒ€í•´ ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”!\"\n        \n    user_input = st.text_input(f'{Intro}: ', '', key='input')\n    submitted = st.form_submit_button('Send') # form ì•„ì´ì½˜ ë³€ê²½ í•  ê²ƒ\n        \n## generated handle part\nif user_input and submitted: \n    Display(user_input)\n# ê²€ì¦ìš© ì½”ë“œ\n# if st.session_state['generated']:\n    \n#     st.text(\"{st.session_state['generated']}\")\n#     st.text(st.session_state['past'])\n\n##################################","undoManager":{"mark":-2,"position":2,"stack":[[{"start":{"row":73,"column":36},"end":{"row":73,"column":43},"action":"remove","lines":["'start'"],"id":4868,"ignore":true},{"start":{"row":73,"column":36},"end":{"row":73,"column":37},"action":"insert","lines":["["]}],[{"start":{"row":73,"column":37},"end":{"row":73,"column":38},"action":"insert","lines":["]"],"id":4869,"ignore":true}],[{"start":{"row":73,"column":39},"end":{"row":74,"column":38},"action":"remove","lines":["","    st.session_state['generated'] = []"],"id":4870,"ignore":true}]]},"ace":{"folds":[],"scrolltop":570.5461608886724,"scrollleft":0,"selection":{"start":{"row":48,"column":4},"end":{"row":48,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":32,"state":"start","mode":"ace/mode/python"}},"timestamp":1695401403865}